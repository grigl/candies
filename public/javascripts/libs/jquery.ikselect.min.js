// ikSelect 0.6.3
// Copyright (c) 2012 Igor Kozlov
// i10k.ru

;(function($,y,z,A){defaults={syntax:'<div class="ik_select_link"><span class="ik_select_link_text"></span></div><div class="ik_select_block"><div class="ik_select_list"></div></div>',autoWidth:true,ddFullWidth:true,customClass:"",maxHeight:200};var B=$([]);var C=false;var D=-1;var E=(/iphone|ipad|ipod|android/i.test(navigator.userAgent.toLowerCase()));var F=(/android/i.test(navigator.userAgent.toLowerCase()));function ikSelect(a,b){this.element=a;this.options=$.extend({},defaults,b);this._defaults=defaults;this._name='ikSelect';if(typeof this.element==='undefined'){return this}this.fakeSelect=$('<div class="ik_select">'+this.options['syntax']+'</div>');this.select=$(this.element);this.link=$(".ik_select_link",this.fakeSelect);this.linkText=$(".ik_select_link_text",this.fakeSelect);this.block=$(".ik_select_block",this.fakeSelect);this.list=$(".ik_select_list",this.fakeSelect);this.listInner=$('<div class="ik_select_list_inner"/>');this.active=$([]);this.hover=$([]);this.init()};$.extend(ikSelect.prototype,{init:function(){var i=this;var j=this.options['autoWidth'];var k=this.options['ddFullWidth'];var l=this.fakeSelect;var m=this.select;var n=this.link;var o=this.linkText;var p=this.block;var q=this.list;var r=this.listInner;q.append(r);l.addClass(this.options['customClass']);i.reset();if(m.attr("disabled")){i.disable_select()};n.bind("click.ikSelect",function(){if(l.data("ik_select_disabled")){return this};if(B.length){B.data("plugin_ikSelect").hide_block()};if(!E){i.show_block()};m.focus()});m.bind("focus.ikSelect",function(){if(l.data("ik_select_disabled")){return this};n.addClass("ik_select_focus");if(l.offset().top+l.height()>$(y).scrollTop()+$(y).height()){$(y).scrollTop(l.offset().top-$(y).height()/2)}});m.bind("blur.ikSelect",function(){if(l.data("ik_select_disabled")){return this};n.removeClass("ik_select_focus")});m.bind("change.ikSelect",function(a){a.preventDefault();i._select_fake_option()});m.bind("keydown.ikSelect keyup.ikSelect",function(a){var b=a.which;var c=i.active;var d=i.hover;switch(b){case 40:if(a.type=="keydown"){a.preventDefault();var e;if(d.next("li").length){e=d.next("li")}else if(d.parents(".ik_select_optgroup").next().length){e=d.parents(".ik_select_optgroup").next().find("li:first")};if(e&&e.length){i._move_to(e)}};if(a.type=="keyup"){if(!p.is(":visible")||$.browser.mozilla)m.val($(".ik_select_option",i.hover).attr("title"))};break;case 38:if(a.type=="keydown"){a.preventDefault();var f;if(d.prev("li").length){f=d.prev("li")}else if(d.parents(".ik_select_optgroup").prev().length){f=d.parents(".ik_select_optgroup").prev().find("li:last")};if(f&&f.length){i._move_to(f)}};if(a.type=="keyup"){if(!p.is(":visible")||$.browser.mozilla)m.val($(".ik_select_option",i.hover).attr("title"))};break;case 33:case 36:if(a.type=="keydown"){a.preventDefault();i._move_to($("li:first",q))};break;case 34:case 35:if(a.type=="keydown"){a.preventDefault();i._move_to($("li:last",q))};break;case 32:if(a.type=="keydown"){a.preventDefault();if(!p.is(":visible")){i.show_block()}else{i._select_real_option()}};break;case 13:if(a.type=="keydown"&&p.is(":visible")){a.preventDefault();i._select_real_option()};break;case 27:if(a.type=="keydown"){a.preventDefault();i.hide_block()};break;case 9:if(a.type=="keydown"){a.preventDefault();if(!p.is(":visible")){var g=$("button,input,textarea,select");var h=g.index(m);g.eq(h+1).focus()}};break;default:if(a.type=="keyup"){i._select_fake_option()};break}});m.after(l);if(j||k){p.show().width(9999);r.css("float","left");q.css("position","absolute");var s=q.outerWidth(true);var t=q.width();q.css("position","static");p.hide().css("width","100%");r.css("float","none");if(D==-1){var u=$('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div>');$("body").append(u);var v=$('div',u).innerWidth();u.css('overflow-y','scroll');var w=$('div',u).innerWidth();$(u).remove();D=v-w};var x=m.parent().width();if(k){p.width(s);r.width(t);$("ul",r).width(t)};if(s>x){s=x};if(j){l.width(s)}};i._fix_height();if(!E){m.width(1);m.css({left:-9999,top:0,height:l.height()})};m.prependTo(l);p.data("ik_select_block_left",p.css("left"));p.data("ik_select_block_top",p.css("top"))},reset:function(){var a=this;var b=this.select;var c=this.linkText;var d=this.listInner;c.html(b.html());d.empty();var e='';if($("optgroup",b).length){$("optgroup",b).each(function(){e+='<div class="ik_select_optgroup">';e+='<div class="ik_select_optgroup_label">'+$(this).attr("label")+'</div>';e+='<ul>';$("option",this).each(function(){e+='<li><span class="ik_select_option" title="'+$(this).val()+'">'+$(this).html()+'</span></li>'});e+='</ul>';e+='</div>'})}else{e+='<ul>';$("option",b).each(function(){e+='<li><span class="ik_select_option" title="'+$(this).val()+'">'+$(this).html()+'</span></li>'});e+='</ul>'};d.append(e);a._select_fake_option();a._attach_list_events($("li",d))},_attach_list_events:function(a){var b=this;var c=this.select;var d=this.linkText;var e=this.list;a.bind("click.ikSelect",function(){d.html($(".ik_select_option",this).html());c.val($(".ik_select_option",this).attr("title"));b.active.removeClass("ik_select_active");$(this).addClass("ik_select_active");b.active=$(this);b.hide_block();c.focus()});a.bind("mouseover.ikSelect",function(){b.hover.removeClass("ik_select_hover");b.hover=$(this);$(this).addClass("ik_select_hover")});a.addClass("ik_select_has_events")},set_defaults:function(a){$.extend(this._defaults,a||{});return this},hide_block:function(){var a=this.fakeSelect;var b=this.block;var c=this.select;b.hide().appendTo(a).css({"left":b.data("ik_select_block_left"),"top":b.data("ik_select_block_top")});B=$([]);c.focus()},show_block:function(){if(E&&!F){this.select.focus();return this};var a=this;var b=this.fakeSelect;var c=this.select;var d=this.block;var e=this.list;var f=this.listInner;var g=this.hover;var h=this.active;d.show();var i=$("option",c).index($("option:selected",c));g.removeClass("ik_select_hover");h.removeClass("ik_select_active");var j=$("li:eq("+i+")",e);j.addClass("ik_select_hover ik_select_active");a.hover=j;a.active=j;d.removeClass("ik_select_block_right");d.css("left",d.data("ik_select_block_left"));if(this.options['ddFullWidth']&&b.offset().left+d.outerWidth(true)>$(y).width()){d.addClass("ik_select_block_right");d.css("left",(d.offset().left+d.outerWidth(true)-$(y).width())*(-1))};d.removeClass("ik_select_block_up");d.css("top",d.data("ik_select_block_top"));if(d.offset().top+d.outerHeight(true)>$(y).scrollTop()+$(y).height()){d.addClass("ik_select_block_up");d.css("top",((d.offset().top+d.outerHeight(true)-parseInt(d.data("ik_select_block_top")))-($(y).scrollTop()+$(y).height()))*(-1))};var k=d.offset().left;var l=d.offset().top;d.width(d.width());d.appendTo("body").css({"left":k,"top":l});var m=$(".ik_select_active",e).position().top-e.height()/2;e.data("ik_select_scrollTop",m);f.scrollTop(m);B=c},add_options:function(h){var i=this;var j=this.select;var k=this.list;var l=this.listInner;var m='',selectHtml='';$.each(h,function(c,d){if(typeof d==='string'){m+='<li><span class="ik_select_option" title="'+c+'">'+d+'</span></li>';selectHtml+='<option value="'+c+'">'+d+'</option>'}else if(typeof d==='object'){var e=$("ul:eq("+c+")",k);var f=$("optgroup:eq("+c+")",j);var g=d;$.each(g,function(a,b){m+='<li><span class="ik_select_option" title="'+a+'">'+b+'</span></li>';selectHtml+='<option value="'+a+'">'+b+'</option>'});e.append(m);f.append(selectHtml);m='';selectHtml=''}});if(selectHtml!=''){$(":first",l).append(m);j.append(selectHtml)}i._fix_height();i._attach_list_events($("li:not(.ik_select_has_events)",l))},remove_options:function(d){var e=this;var f=this.select;var g=this.list;var h=$([]);$.each(d,function(b,c){$("option",f).each(function(a){if($(this).val()==c){h=h.add($(this)).add($("li:eq("+a+")",g))}})});h.remove();e._select_fake_option();e._fix_height()},_select_real_option:function(){var a=this.list;var b=this.hover;var c=this.active;c.removeClass("ik_select_active");b.addClass("ik_select_active").click()},_select_fake_option:function(){var a=this.select;var b=this.list;var c=this.linkText;var d=$(":selected",a);var e=$("option",a).index(d);c.html(d.html());$("li",b).removeClass("ik_select_hover").eq(e).addClass("ik_select_hover")},disable_select:function(){var a=this.fakeSelect;var b=this.select;b.attr("disabled","disabled");a.addClass("ik_select_disabled");a.data("ik_select_disabled",true)},enable_select:function(){var a=this.fakeSelect;var b=this.select;b.removeAttr("disabled");a.removeClass("ik_select_disabled");a.data("ik_select_disabled",false)},toggle_select:function(){var a=this;var b=this.fakeSelect;if(b.data("ik_select_disabled")){a.enable_select()}else{a.disable_select()}},make_selection:function(a){var b=this;var c=this.select;c.val(a);b._select_fake_option()},_move_to:function(a){var b=this;var c=this.block;var d=this.linkText;b.hover.removeClass("ik_select_hover");a.addClass("ik_select_hover");b.hover=a;if($.browser.mozilla){b.active.removeClass("ik_select_active");a.addClass("ik_select_active");b.active=a};if(!c.is(":visible")||$.browser.mozilla)d.html($(".ik_select_option",a).html())},_fix_height:function(){var a=this.block;var b=this.listInner;var c=this.options['maxHeight'];var d=this.options['ddFullWidth'];a.show();if(b.height()>c){b.css({overflow:"auto",height:c,position:"relative"});$.data(b,"ik_select_hasScrollbar",true);if(d){a.width(a.width()+D);b.width(b.width()+D)}}else{if($.data(b,"ik_select_hasScrollbar")){b.css({overflow:"",height:"auto"});b.width(b.width()-D);a.width(a.width()-D)}};a.hide()}});$.fn['ikSelect']=function(b){isOperamini=Object.prototype.toString.call(y.operamini)==="[object OperaMini]";if(isOperamini)return this;var c=Array.prototype.slice.call(arguments);return this.each(function(){if(!$.data(this,'plugin_ikSelect')){$.data(this,'plugin_ikSelect',new ikSelect(this,b))}else if(typeof b==='string'){var a=$.data(this,'plugin_ikSelect');switch(b){case'reset':a.reset();break;case'hide_dropdown':a.hide_block();break;case'show_dropdown':a.show_block();C=true;break;case'add_options':a.add_options(c[1]);break;case'remove_options':a.remove_options(c[1]);break;case'enable':a.enable_select();break;case'disable':a.disable_select();break;case'toggle':a.toggle_select();break;case'select':a.make_selection(c[1]);break;case'set_defaults':a.set_defaults(c[1]);break}}})};$.ikSelect=new ikSelect();$(z).bind("click.ikSelect",function(a){if(!C&&B.length&&!$(a.target).parents(".ik_select").length){B.ikSelect("hide_dropdown");B=$([])};if(C){C=false}})})(jQuery,window,document);